C51 COMPILER V9.00   MAIN                                                                  03/06/2017 10:59:07 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\Main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE source code\Main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\include) DEFINE(FOS
                    -C_160000) DEBUG OBJECTEXTEND PRINT(.\Listings\Main.lst) TABS(2) OBJECT(.\Objects\Main.obj)

line level    source

   1          /*--------------------------------------------------------------------------------------------------------
             --*/
   2          /*                                                                                                        
             - */
   3          /* Copyright(c) 2016 Nuvoton Technology Corp. All rights reserved.                                        
             - */
   4          /*                                                                                                        
             - */
   5          /*--------------------------------------------------------------------------------------------------------
             --*/
   6          
   7          //********************************************************************************************************
             -***
   8          //  Nuvoton Technoledge Corp. 
   9          //  Website: http://www.nuvoton.com
  10          //  E-Mail : MicroC-8bit@nuvoton.com
  11          //  Date   : Apr/21/2016
  12          //********************************************************************************************************
             -***
  13          
  14          //********************************************************************************************************
             -***
  15          //  File Function: N76E885 ADC demo code
  16          //********************************************************************************************************
             -***
  17          
  18          #include <stdio.h>
  19          #include "N76E003.h"
  20          #include "Define.h"
  21          #include "Common.h"
  22          #include "Delay.h"
  23          #include "SFR_Macro.h"
  24          #include "Function_define.h"
  25          #include "INT1.h"
  26          #include "Time2.h"
  27          
  28          
  29          
  30          //*****************  The Following is in define in Fucntion_define.h  ***************************
  31          //****** Always include Function_define.h call the define you want, detail see main(void) *******
  32          //***********************************************************************************************
  33          #if 0
              #define Enable_ADC_AIN0     ADCCON0&=0xF0;P17_Input_Mode;AINDIDS=0x00;AINDIDS|=SET_BIT0;ADCCON1|=SET_BIT0     
             -            //P17
              #define Enable_ADC_AIN1     ADCCON0&=0xF0;ADCCON0|=0x01;P30_Input_Mode;AINDIDS=0x00;AINDIDS|=SET_BIT1;ADCCON
             -1|=SET_BIT0    //P30
              #define Enable_ADC_AIN2     ADCCON0&=0xF0;ADCCON0|=0x02;P07_Input_Mode;AINDIDS=0x00;AINDIDS|=SET_BIT2;ADCCON
             -1|=SET_BIT0    //P07
              #define Enable_ADC_AIN3     ADCCON0&=0xF0;ADCCON0|=0x03;P06_Input_Mode;AINDIDS=0x00;AINDIDS|=SET_BIT3;ADCCON
             -1|=SET_BIT0    //P06
              #define Enable_ADC_AIN4     ADCCON0&=0xF0;ADCCON0|=0x04;P05_Input_Mode;AINDIDS=0x00;AINDIDS|=SET_BIT4;ADCCON
             -1|=SET_BIT0    //P05
              #define Enable_ADC_AIN5     ADCCON0&=0xF0;ADCCON0|=0x05;P04_Input_Mode;AINDIDS=0x00;AINDIDS|=SET_BIT5;ADCCON
             -1|=SET_BIT0    //P04
C51 COMPILER V9.00   MAIN                                                                  03/06/2017 10:59:07 PAGE 2   

              #define Enable_ADC_AIN6     ADCCON0&=0xF0;ADCCON0|=0x06;P03_Input_Mode;AINDIDS=0x00;AINDIDS|=SET_BIT6;ADCCON
             -1|=SET_BIT0    //P03
              #define Enable_ADC_AIN7     ADCCON0&=0xF0;ADCCON0|=0x07;P11_Input_Mode;AINDIDS=0x00;AINDIDS|=SET_BIT7;ADCCON
             -1|=SET_BIT0    //P11
              #define Enable_ADC_BandGap  ADCCON0|=0x0F;ADCCON1|=SET_BIT0                                                               //Band-gap 1.22V
              
              #define PWM0_FALLINGEDGE_TRIG_ADC   ADCCON0&=~SET_BIT5;ADCCON0&=~SET_BIT4;ADCCON1&=~SET_BIT3;ADCCON1&=~SET_
             -BIT2;ADCCON1|=SET_BIT1
              #define PWM2_FALLINGEDGE_TRIG_ADC   ADCCON0&=~SET_BIT5;ADCCON0|=SET_BIT4;ADCCON1&=~SET_BIT3;ADCCON1&=~SET_B
             -IT2;ADCCON1|=SET_BIT1
              #define PWM4_FALLINGEDGE_TRIG_ADC   ADCCON0|=SET_BIT5;ADCCON0&=~SET_BIT4;ADCCON1&=~SET_BIT3;ADCCON1&=~SET_B
             -IT2;ADCCON1|=SET_BIT1
              #define PWM0_RISINGEDGE_TRIG_ADC    ADCCON0&=~SET_BIT5;ADCCON0&=~SET_BIT4;ADCCON1&=~SET_BIT3;ADCCON1|=SET_BI
             -T2;ADCCON1|=SET_BIT1
              #define PWM2_RISINGEDGE_TRIG_ADC    ADCCON0&=~SET_BIT5;ADCCON0|=SET_BIT4;ADCCON1&=~SET_BIT3;ADCCON1|=SET_BIT
             -2;ADCCON1|=SET_BIT1
              #define PWM4_RISINGEDGE_TRIG_ADC    ADCCON0|=SET_BIT5;ADCCON0&=~SET_BIT4;ADCCON1&=~SET_BIT3;ADCCON1|=SET_BIT
             -2;ADCCON1|=SET_BIT1
              
              #define P04_FALLINGEDGE_TRIG_ADC    ADCCON0|=0x30;ADCCON1&=0xF3;ADCCON1|=SET_BIT1;ADCCON1&=~SET_BIT6
              #define P13_FALLINGEDGE_TRIG_ADC    ADCCON0|=0x30;ADCCON1&=0xF3;ADCCON1|=SET_BIT1;ADCCON1|=SET_BIT6
              #define P04_RISINGEDGE_TRIG_ADC     ADCCON0|=0x30;ADCCON1&=~SET_BIT3;ADCCON1|=SET_BIT2;ADCCON1|=SET_BIT1;ADC
             -CON1&=~SET_BIT6
              #define P13_RISINGEDGE_TRIG_ADC     ADCCON0|=0x30;ADCCON1&=~SET_BIT3;ADCCON1|=SET_BIT2;ADCCON1|=SET_BIT1;ADC
             -CON1|=SET_BIT6
              #endif
  56          
  57          
  58          #if 1
  59          #define boot_code_min 0x30//800//32000        //8ms
  60          #define boot_code_max 0x37//1500//60000       //15ms
  61          #define data0_min     80//3200        //0.8ms
  62          #define data0_max     150//6000       //1.5ms
  63          #define data1_min     200//8000       //2ms
  64          #define data1_max     250//10000        //2.5ms
  65          #define Num           33          //32code
  66          
  67          
  68          UINT8     CodeNum=0,Code[5]={0};
  69          UINT8     time=0,n=0;
  70          BIT       First_INT=0,Start_Flag=0;
  71          //-------------------------------------------------------------------------
  72          void INT1_ISR() interrupt 2
  73          {
  74   1        n++;
  75   1        #if 1
  76   1          clr_TR0;
  77   1        time=TH0;
  78   1        TH0=0;
  79   1        TL0=0;
  80   1              set_TR0;
  81   1          clr_EX1;
  82   1          if(!First_INT)
  83   1          {
  84   2              time = 0;
  85   2              First_INT = 1;
  86   2          }
  87   1          else
  88   1          {
  89   2              if((time>boot_code_min)&&(time<boot_code_max))
  90   2              {
  91   3                  Start_Flag = 1;
C51 COMPILER V9.00   MAIN                                                                  03/06/2017 10:59:07 PAGE 3   

  92   3                  CodeNum = 0;
  93   3                  time = 0;
  94   3              }
  95   2              else if(!Start_Flag)
  96   2              {
  97   3                  First_INT = 1;
  98   3                  time = 0;
  99   3              }
 100   2              if(Start_Flag&&time!=0)
 101   2              {
 102   3                  if((time>data0_min)&&(time<data0_max))          //code: 0
 103   3                  {
 104   4                      Code[CodeNum/8] = Code[CodeNum/8] & 0xfe;
 105   4                  }
 106   3                  else if((time>data1_min)&&(time<data1_max))     //code: 1
 107   3                  {
 108   4                      Code[CodeNum/8] = Code[CodeNum/8] | 0x01;
 109   4                  }
 110   3                  time = 0;
 111   3                  CodeNum++;
 112   3                  if(CodeNum>=Num)
 113   3                  {
 114   4                      clr_TR0;
 115   4                      CodeNum = 0;
 116   4                      Start_Flag = 0;
 117   4                      First_INT = 0;
 118   4                  }
 119   3              }
 120   2          }
 121   1          set_EX1;
 122   1          #endif
 123   1      }
 124          #endif
 125          
 126          #if 0
              /******************************************************************************
               * FUNCTION_PURPOSE: I/O Pin interrupt Service Routine
               ******************************************************************************/
              void PinInterrupt_ISR (void) interrupt 7
              {
                  clr_TR2;                                                    // Timer2 stop
                  th = TH2;
                  TL2 = 0;TH2 = 0;set_TR2;                                    // Timer2 run
                  PIF = 0x00;                                                 //clear interrupt flag
                  if((count==1)&&(th>boot_code_min>>256)&&(th<boot_code_max)) //?boot_code  
                  {
                      boot_code_flag = 1;
                  }
                  if(boot_code_flag)
                  {
                      if((count>1)&&(count<34))
                      {
                          if((th>data0_min)&&(th<data0_max))                  //0
                          {
                              data_code[(count-2)/8] = data_code[(count-2)/8] & 0xfe;
                          }
                          if((th>data1_min)&&(th<data1_max))                  //1
                          {
                              data_code[(count-2)/8] = data_code[(count-2)/8] | 0x01;
                          }
                      }
                      count++;
C51 COMPILER V9.00   MAIN                                                                  03/06/2017 10:59:07 PAGE 4   

                      if(count>=34)
                      {
                          count = 0;
                          boot_code_flag = 0;
                          clr_TR2;
                          TL2 = 0;TH2 = 0;
                      }
                  }
              }
              #endif
 164          
 165          /******************************************************************************
 166          The main C function.  Program execution starts
 167          here after stack initialization.
 168          ******************************************************************************/
 169          void main (void) 
 170          {
 171   1          Set_All_GPIO_Quasi_Mode;
 172   1      
 173   1          INT1_ISR_init();
 174   1          Time0_ISR_init();
 175   1          set_EA;               //¿ª×ÜÖÐ¶Ï
 176   1          //set_TR2;
 177   1         // Timer1_Delay1ms(100);
 178   1          //set_EX1;
 179   1          while(1)
 180   1          {
 181   2             // set_PD;           //Enter Power Down wait 
 182   2          }
 183   1      }
 184          
 185          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    178    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
